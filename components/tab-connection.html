<section class="tab-panel active" id="tab-connection" role="tabpanel">
    <div class="panel-grid">
        <section class="card">
            <h2>Connection Status</h2>
            <div class="button-row">
                <button id="connectButton">Scan &amp; Connect</button>
                <button id="disconnectButton" disabled data-connected-only>Disconnect</button>
            </div>
            <div id="status">
                <p id="statusText">Web Bluetooth not initialized.</p>
                <p id="deviceName">Device: N/A</p>
                <p id="connectionStrength" style="display: flex; align-items: flex-end; gap: 0.5rem;">
                    <span style="line-height: 10px;">Signal:</span> 
                    <span id="rssiValue" style="line-height: 20px;">--</span>
                    <span id="rssiIndicator" style="display: inline-flex; gap: 2px; align-items: flex-end; height: 20px;">
                        <span class="signal-bar" style="height: 8px; width: 3px; background: #30363d; border-radius: 1px;"></span>
                        <span class="signal-bar" style="height: 12px; width: 3px; background: #30363d; border-radius: 1px;"></span>
                        <span class="signal-bar" style="height: 16px; width: 3px; background: #30363d; border-radius: 1px;"></span>
                        <span class="signal-bar" style="height: 20px; width: 3px; background: #30363d; border-radius: 1px;"></span>
                    </span>
                </p>
            </div>
        </section>

        <section class="card">
            <h2>Device History</h2>
            <p class="subtext">Devices you've connected to will appear here.</p>
            <!-- <div class="button-row">
                <label class="checkbox-label">
                    <input type="checkbox" id="scanAllDevices">
                    <span>Show All BLE Devices (not just drone service)</span>
                </label>
            </div> -->
            <ul id="deviceList" class="device-list">
                <li class="empty">No devices discovered yet.</li>
            </ul>
        </section>

        <section class="card">
            <h2>Device ID Configuration</h2>
            <div class="inline-field">
                <label for="deviceIdInput">Device ID:</label>
                <input type="number" id="deviceIdInput" min="0" max="255" step="1" value="0" data-connected-only>
                <button id="setDeviceIdButton" data-connected-only>Set ID</button>
            </div>
            <p class="subtext" style="margin-top: 0.5rem; font-size: 0.75rem; color: #8b949e;">
                ⚠️ Setting a new ID will reboot the device and disconnect. After disconnection, refresh the page and reconnect to see the updated device name.
            </p>
        </section>

        <section class="card">
            <h2>Device Snapshot</h2>
            <ul>
                <li>Firmware: v<span id="firmwareVersion">--</span></li>
                <!-- <li>Battery: <span id="batteryLevel">--</span></li>
                <li>Temperature: <span id="temperature">--</span></li> -->
            </ul>
        </section>
    </div>
</section>
